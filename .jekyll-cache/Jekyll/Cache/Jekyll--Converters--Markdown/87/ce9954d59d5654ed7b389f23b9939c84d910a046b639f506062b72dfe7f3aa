I"B<p>So I want to make a plugin that allows me to make quick sketches on my posts.</p>

<p>First I’m going to install a local wordpress on my comp to work with.</p>

<p>Turns out I didn’t have mysql installed</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install mysql





mysql.server start




mysql -uroot
</code></pre></div></div>

<p>Then</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE USER 'wordpress'@'localhost' IDENTIFIED BY 'wordpress';
</code></pre></div></div>

<p>Probably might want to pick a different password or whatever.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE DATABASE wordpress;




GRANT ALL PRIVILEGES ON wordpress . * TO 'wordpress'@'localhost';
</code></pre></div></div>

<p>Following 5-minute setup guide.</p>

<p>cd into the wordpress folder. Run the following to make a server at 127.0.0.1:8000 in the unzipped wordpress folder</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php -S 127.0.0.1:8000 -t .
</code></pre></div></div>

<p>Changed wp-config-sample.php to wp-config.php</p>

<p>and put all my passwords and stuff in there</p>

<p>ERROR ON ESTABLISHING DATABASE CONNECTION</p>

<p>okay.</p>

<p>So I found this script</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
$db = @mysql_connect('127.0.0.1', 'wordpress', 'wordpress');
if (!$db) echo "connection failed";
else echo "connection succeeded";
?&gt;
</code></pre></div></div>

<p>and ran it.</p>

<p>Turns out need to replace localhost with 127.0.0.1</p>

<p>I don’t know why. Whatevs.</p>

<p>Smooth sailin.</p>

<p>Made my username wordpress and password wordpress. Don’t host this for real.</p>

<p>ALRIGHT WE’RE IN.</p>

<p>Installing something by going to a webpage is so goddamn bizarre. I feel like I’m in 1995 or some shit.</p>

<p>php sickens me.</p>

<p>It’s fun being a snob! ^o^</p>

<p>Here’s some useful looking links</p>

<p><a href="http://solislab.com/blog/how-to-make-shortcodes-user-friendly/">http://solislab.com/blog/how-to-make-shortcodes-user-friendly/</a></p>

<p><a href="http://stackoverflow.com/questions/2368784/draw-on-html5-canvas-using-a-mouse">http://stackoverflow.com/questions/2368784/draw-on-html5-canvas-using-a-mouse</a></p>

<p><a href="http://www.tinymce.com/wiki.php/Tutorials:Creating_a_plugin">http://www.tinymce.com/wiki.php/Tutorials:Creating_a_plugin</a></p>

<p>Okay so the first one seems good but its antiquated</p>

<p><a href="https://codex.wordpress.org/Plugin_API/Filter_Reference/mce_external_plugins">https://codex.wordpress.org/Plugin_API/Filter_Reference/mce_external_plugins</a></p>

<p>Led me here.</p>

<p>The way buttons are made in tinymce has changed. Check out the new way.</p>

<p>I had some trouble getting the mouse to actually draw where it should. I ended up using a recursive travel up through the page to add up all the offsets as seen here.</p>

<p><a href="http://stackoverflow.com/questions/11444401/perfecting-canvas-mouse-coordinates">http://stackoverflow.com/questions/11444401/perfecting-canvas-mouse-coordinates</a></p>

<p>The approach I decided to go with was making a seperate php file that the jquery request will post the image data to.</p>

<p>the wordpress function media_handle_upload can be called on the server side.</p>

<p><a href="https://codex.wordpress.org/Function_Reference/media_handle_upload">https://codex.wordpress.org/Function_Reference/media_handle_upload</a></p>

<p>I didn’t realize how hat i also needed to include wp-load.php from the example and was getting weird __() can’t be found kind of errors.</p>

<p>This was helpful in packing the images into blobs and the forms in a way that wordpress likes.</p>

<p>http://stackoverflow.com/questions/4998908/convert-data-uri-to-file-then-append-to-formdata</p>

<p>The jquery ajax is quite particular. Apparntly you need to include the lines</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	jQuery.ajax({
				type: 'POST',
				url:"/wp-content/plugins/myGallery2/upload_image.php",
				data:formData,
				contentType: false,
    		processData: false,

				success: function(data){
					console.log(data);
					var mytext = "&lt;img src=" + data + "/&gt;"
					tinyMCE.activeEditor.execCommand('mceInsertContent', 0, mytext);
				}
			});
</code></pre></div></div>

<p>contenttpye false, processdata false in order for it to work.</p>

<p>I just took a wild stab at inserting the image with the img tag and it seems ok.</p>

<p>THIS HAS BEEN A HORRIBLE UNPLEASANT PROJECT.</p>

<p>Find it at <a href="https://github.com/philzook58/mrsketcho">https://github.com/philzook58/mrsketcho</a></p>

<p><a href="/assets/Mon-Nov-09-2015-233813-GMT-0500-EST.png"><img src="/assets/Mon-Nov-09-2015-234733-GMT-0500-EST.png" alt="" /></a></p>

<p>BOOOOOOYAAAAAAAHHHH</p>

<p><img src="/assets/Mon-Nov-09-2015-234836-GMT-0500-EST.png" alt="" /></p>
:ET