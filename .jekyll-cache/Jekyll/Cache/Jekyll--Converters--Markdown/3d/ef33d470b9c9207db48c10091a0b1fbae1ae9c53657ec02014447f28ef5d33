I"∆<p>Floating points are nice and all. You can get pretty far pretending they are actually numbers. But they don‚Äôt obey some mathematical properties that feel pretty obvious. A classic to glance through is ‚ÄúWhat Every Computer Scientist Should Know About Floating-Point Arithmetic‚Äù <a href="https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html</a></p>

<p>We can check some properties with z3py. Here are a couple simple properties that succeed for mathematical integers and reals, but fail for floating point</p>

<p>[gist https://gist.github.com/philzook58/3632e1cd323171c69875c811c9b7a34c#file-numbery-py]</p>

<p>I recently saw on twitter a reference to a Sylvie Boldo paper <a href="https://hal.archives-ouvertes.fr/hal-01148409/">https://hal.archives-ouvertes.fr/hal-01148409/</a> ‚ÄúStupid is as Stupid Does: Taking the Square Root of the Square of a Floating-Point Number‚Äù.</p>

<p>https://twitter.com/fatlimey/status/1225496023553978369?s=20</p>

<table>
  <tbody>
    <tr>
      <td>In it, she uses FlocQ and Coq to prove a somewhat surprising result that the naive formula $latex \sqrt{x^2} =</td>
      <td>x</td>
      <td>$ actually is correct for the right rounding mode of floating point, something I wouldn‚Äôt have guessed.</td>
    </tr>
  </tbody>
</table>

<p>Z3 confirms for <code class="language-plaintext highlighter-rouge">Float16</code>. I can‚Äôt get <code class="language-plaintext highlighter-rouge">Float32</code> to come back after even a day on a fairly beefy computer. If I use <code class="language-plaintext highlighter-rouge">FPSort(ebits,sbits)</code> rather than a standard size, it just comes back unknown, so i can‚Äôt really see where the cutoff size is. This does not bode well for checking properties of floating point in z3 in general. I think a brute force for loop check of 32 bit float properties is feasible. I might even be pretty fast. To some degree, if z3 is taking forever to find a counterexample, I wonder to what to degree the property is probably true.</p>

<p>If anyone has suggestions, I‚Äôm all ears.</p>

<p>[gist https://gist.github.com/philzook58/3632e1cd323171c69875c811c9b7a34c#file-stupid-py]</p>

:ET